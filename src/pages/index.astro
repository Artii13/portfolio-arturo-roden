---
import Layout from '@/layouts/Layout.astro';
import Header from '@/components/layout/Header.astro';
import Footer from '@/components/layout/Footer.astro';
import Hero from '@/components/sections/Hero.astro';
import Metrics from '@/components/sections/Metrics.astro';
import Manifesto from '@/components/sections/Manifesto.astro';
import TechCarousel from '@/components/sections/TechCarousel.astro';
import Projects from '@/components/sections/Projects.astro';
import Testimonials from '@/components/sections/Testimonials.astro';
import CTA from '@/components/sections/CTA.astro';
import GridBackground from '@/components/effects/GridBackground.astro';

function splitWords(text: string, baseDelay: number, stagger: number): string {
  return text.split(' ').map((word, index) => {
    const delay = (baseDelay + (index * stagger)).toFixed(2);
    return `<span class="blur-reveal-word" style="animation-delay: ${delay}s">${word}</span>`;
  }).join(' ');
}

const labelHtml = splitWords('Diseño Web · IA · Automatización', 0, 0.08);
const titleHtml = splitWords('Diseño la tecnología invisible que hace visibles tus resultados.', 0.5, 0.06);
const descHtml = splitWords('Creo sistemas completos que integran diseño estratégico, automatización de procesos y agentes de IA. Todo bajo tu marca, todo conectado, todo funcionando 24/7.', 1.5, 0.03);
---

<Layout>
  <!-- Grid Background 3D -->
  <GridBackground />
  
  <!-- Main Container -->
  <main id="main-container" class="w-full max-w-[1400px] rounded-[2.5rem] shadow-2xl relative flex flex-col overflow-hidden">
    
    <!-- Sección Hero con fondo claro -->
    <div id="hero-section" class="bg-[#F5F5F3] rounded-t-[2.5rem] relative">
      <Header />
      <Hero heroLabel={labelHtml} heroTitle={titleHtml} heroDescription={descHtml} />
    </div>
    
    <!-- Sección Métricas - Fondo oscuro -->
    <div id="metrics-section" class="bg-[#0a0a0a]">
      <Metrics />
    </div>
    
    <!-- Sección Manifesto - Fondo claro -->
    <div id="manifesto-section" class="bg-[#F5F5F3]">
      <Manifesto />
    </div>
    
    <!-- Sección Tech Carousel - Fondo oscuro -->
    <div id="tech-carousel-section" class="bg-[#0a0a12]">
      <TechCarousel />
    </div>
    
    <!-- Sección Proyectos - Fondo claro -->
    <div id="projects-section" class="bg-[#F5F5F3]">
      <Projects />
    </div>
    
    <!-- Sección Testimonios - Fondo oscuro -->
    <div id="testimonials-section" class="bg-[#0a0a0a]">
      <Testimonials />
    </div>
    
    <!-- Sección CTA y Footer - Fondo claro -->
    <div id="cta-section" class="bg-[#F5F5F3]">
      <CTA />
      <Footer />
    </div>
    
  </main>
</Layout>

<style is:global>
  @keyframes blurReveal {
    0% {
      opacity: 0;
      filter: blur(10px);
      transform: translateY(20px);
    }
    100% {
      opacity: 1;
      filter: blur(0);
      transform: translateY(0);
    }
  }

  .blur-reveal-word {
    display: inline-block;
    opacity: 0;
    animation: blurReveal 0.7s cubic-bezier(0.25, 0.1, 0.25, 1) forwards;
  }
  
  /* Asegurar que el hero-title y hero-description permiten el efecto */
  .hero-title,
  .hero-description,
  .hero-label {
    overflow: visible;
  }
</style>

<script>
  // Smooth scroll para enlaces internos con Lenis (TypeScript compatible)
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
      anchor.addEventListener('click', function(e) {
        e.preventDefault();
        const href = (e.currentTarget as HTMLAnchorElement).getAttribute('href');
        if (!href) return;
        
        const target = document.querySelector(href);
        if (!target) return;
        
        // Intentar usar Lenis si existe
        const win = window as typeof window & { 
          lenisInstance?: { 
            scrollTo: (target: Element, options?: { offset?: number; duration?: number }) => void 
          } 
        };
        
        if (win.lenisInstance) {
          win.lenisInstance.scrollTo(target, {
            offset: 0,
            duration: 1.2
          });
        } else {
          // Fallback a scroll nativo suave
          target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });
  });
</script>
